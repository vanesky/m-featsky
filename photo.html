<!doctype html>
<html lang="en">
<head>
    <title>FEATSKY Best-1.0</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="featsky,featsky博客,641151096"/>
    <meta name="description" content="featsky的个人博客,641151096的个人博客"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="src/css/base.css">
    <link rel="stylesheet" href="src/css/photo.css">
    <link rel="stylesheet" href="src/css/m2-banner.css">
</head>
<body>

    <header>
        <!--<img id="logo" src="img/logo.png" alt="">-->
        <ul class="menu-list fx-col-b">
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <h4 class="titles">相册</h4>
    </header>

    <nav class="nav-tit clearfix">
        <ul class="nav-item fx-row-a">
            <li class="item-list fx-col-e">
                <p>最近</p>
                <div class="list-line c-ba"></div>
            </li>
            <li class="item-list fx-col-e">
                <p>全部</p>
                <div class="list-line"></div>
            </li>
            <!--<li class="item-list fx-col-e">
                <h4>散文</h4>
                <div class="list-line"></div>
            </li>-->
        </ul>
    </nav>

    <div class="container">

        <section id="channel-latest" class="">
            <!--模板填充-->
        </section>

        <section id="channel-all" class="hide">
            <ul class="list-item clearfix">
                <li class="img-list"></li>
                <li class="img-list"></li>
                <li class="img-list"></li>
                <li class="img-list"></li>
            </ul>
        </section>

    </div>


    <!--导航组件-->
    <div id="nav">
        <div class="nav-head"></div>
        <ul class="nav-item">
            <li class="nav-list">
                <img src="img/fixed/home-white.png" alt="">
                <span>主页</span>
            </li>
            <li class="nav-list">
                <img src="img/fixed/say-white.png" alt="">
                <span>说说</span>
            </li>
            <li class="nav-list">
                <img src="img/fixed/article-white.png" alt="">
                <span>文章</span>
            </li>
            <li class="nav-list">
                <img src="img/fixed/movie-white.png" alt="">
                <span>影视</span>
            </li>
            <li class="nav-list">
                <img src="img/fixed/photo.png" alt="">
                <span>照片</span>
            </li>
            <li class="nav-list">
                <img src="img/fixed/message-white.png" alt="">
                <span>留言</span>
            </li>
        </ul>
    </div>

    <!--最近模板*****************-->
    <div id="model-1" class="hide">
        <h3 data-name="time" class="date-tit"></h3>
        <ul data-name="imgPath" class="list-item clearfix">

        </ul>
    </div>

    <!--最近模板(子模板)-->
    <div id="model-1-a" class="hide">
        <li class="img-list"></li>
    </div>
    <!--**************************-->
    <!--全部模板-->



    <!--查看图片组件-->
    <section class="banner-img">
        <div id="header-bg">
            <img class="back" src="img/fixed/arrow.png" alt="">
            <p id="header-title"><span id="title-grade"></span>/<span id="title-grades"></span></p>
        </div>

        <ul class="banner-img-main">
            <!--<li class="banner-list fx-col-c"><img src="img/21.jpg" alt=""></li>
            <li class="banner-list fx-col-c"><img src="img/3.jpg" alt=""></li>
            <li class="banner-list fx-col-c"><img src="img/4.jpg" alt=""></li>-->
        </ul>
    </section>
    <!--***********图片组件子列表模板*************-->
    <div id="model-2" class="hide">
        <li class="banner-list fx-col-c"><img src="" alt=""></li>
    </div>
    <!--*****************************************-->

    <script src="src/lib/zepto.js"></script>
    <script src="src/js/common.js"></script>
    <script src="src/js/ajax.js"></script>

    <script src="component/album/m2-banner.js"></script>
    <script src="component/album/album_render.js"></script>
    <script>

        $(function(){

            var pageResult = 0,pageCount = 1,w = $(window).width();

            renderImg();

            //图片间隔宽度
            imgListWidth(2);

            //图片渲染
            function renderImg(){

                app.ajax('get',app.url('getImgList.php'),{page:pageCount,pageStart:pageResult},function(data){

                    var obj = data,str = '',page = '';

                    console.log(obj);

                    var model = $('#model-1').clone();

                    var imgListModel = $("#model-1-a").clone();


                    for(var i=0;i<obj.length;i++){

                        var imgStr = '';

                        if(obj[i].statusCode == 404){continue;}

                        for(var j=0;j<obj[i].data.length;j++){

                            //时间
                            model.find("[data-name='time']").text(obj[i].data[j].time)

                            imgListModel.find('.img-list').css('background-image',"url(img/"+obj[i].data[j].imgPath+")").attr('data-id',obj[i].data[j].id);

                            imgStr += imgListModel.html();
                        }

                        //向内存中的dom模板插入图片数列表
                        model.find('.list-item').html(imgStr);

                        imgListLeft(model.find('.img-list'),2);


                        //保存对象列表字符串到变量
                        str +=  model.html();

                        page = obj[i].page;
                    }

                    if(str == ''){

                        alert('没了')

                    }else{

                        //将变量字符串插入真实dom
                        $('#channel-latest').append(str);

                    }

                    return pageResult =  page;
                })
            }

            //==================================================================

            //图片大小和边距
            function imgListWidth(param){

                //var w = JSON.parse(localStorage.getItem('device')).w

                var liw = (w-param*2)/3 - 0.1;

                $('.img-list').css({

                    width:liw + 'px',

                    height:liw + 'px',

                });
            }

            //边距(分别获取设置边距)
            function imgListLeft(obj,param){

                for(var i=0;i<obj.length;i++){

                    if(i%3!=0){ obj.eq(i).css('margin-left',param + 'px') }

                }
            }

            //==================================================================

            $('.titles').click(function(){

                renderImg();

            })

            //调用图片组件
            var bimObj =  $('.banner-img-main');

            bimObj.bannerMove({

                speed:400,

                second:1

            });

            //页面图片列表事件
            $('#channel-latest').on('tap','.img-list',function(){
                //最近|全部
                var pageImgObj = $('#channel-latest').find('.img-list');

                com.pageImageEvent(pageImgObj,this,bimObj)

            })


        })

    </script>

</body>
</html>

















