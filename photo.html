<!doctype html>
<html lang="en">
<head>
    <title>FEATSKY Best-1.0</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="featsky,featsky博客,641151096"/>
    <meta name="description" content="featsky的个人博客,641151096的个人博客"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="src/css/base.css">
    <link rel="stylesheet" href="src/css/photo.css">
    <link rel="stylesheet" href="src/css/m2-banner.css">
</head>
<body>

    <header>
        <!--<img id="logo" src="img/logo.png" alt="">-->
        <ul class="nav-list fx-col-b">
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <h4 class="titles">相册</h4>
    </header>

    <nav class="nav-tit clearfix">
        <ul class="nav-item fx-row-a">
            <li class="item-list fx-col-e">
                <p>最近</p>
                <div class="list-line c-ba"></div>
            </li>
            <li class="item-list fx-col-e">
                <p>全部</p>
                <div class="list-line"></div>
            </li>
            <!--<li class="item-list fx-col-e">
                <h4>散文</h4>
                <div class="list-line"></div>
            </li>-->
        </ul>
    </nav>

    <div class="container">

        <section id="channel-latest" class="">
            <!--<h3 class="date-tit">2015-05-15</h3>
            <ul class="list-item clearfix">
                <li class="img-list"></li>
                <li class="img-list"></li>
                <li class="img-list"></li>
                <li class="img-list"></li>
            </ul>-->
        </section>

        <section id="channel-all" class="hide">
            <ul class="list-item clearfix">
                <li class="img-list"></li>
                <li class="img-list"></li>
                <li class="img-list"></li>
                <li class="img-list"></li>
            </ul>
        </section>

    </div>

    <!--banner图片-->
    <section class="banner-img">
        <ul class="banner-img-main">
            <li class="banner-list"><img src="img/2.jpg" alt=""></li>
            <li class="banner-list"><img src="img/3.jpg" alt=""></li>
            <li class="banner-list"><img src="img/4.jpg" alt=""></li>
        </ul>
    </section>


    <!--最近模板*****************-->
    <div id="model-1" class="hide">
        <h3 data-name="time" class="date-tit"></h3>
        <ul data-name="imgPath" class="list-item clearfix">

        </ul>
    </div>

    <!--最近模板(子模板)-->
    <div id="model-1-a" class="hide">
        <li class="img-list"></li>
    </div>
    <!--**************************-->
    <!--全部模板-->

    <script src="src/lib/zepto.js"></script>
    <script src="src/js/common.js"></script>
    <script src="src/js/ajax.js"></script>
    <script src="src/js/m2-banner.js"></script>
    <script>

        $(function(){

            var pageResult = 0,pageCount = 1;

            renderImg();

            //图片间隔宽度
            imgListWidth(2);

            //图片渲染
            function renderImg(){

                app.ajax('get',app.url('getImgList.php'),{page:pageCount,pageStart:pageResult},function(data){

                    var obj = data,str = '',page = '';

                    console.log(obj);

                    var model = $('#model-1').clone();

                    var imgListModel = $("#model-1-a").clone();


                    for(var i=0;i<obj.length;i++){

                        var imgStr = '';

                        if(obj[i].statusCode == 404){continue;}

                        for(var j=0;j<obj[i].data.length;j++){

                            //时间
                            model.find("[data-name='time']").text(obj[i].data[j].time)

                            imgListModel.find('.img-list').css('background-image',"url(img/"+obj[i].data[j].imgPath+")").attr('data-id',obj[i].data[j].id);

                            imgStr += imgListModel.html();
                        }

                        //向内存中的dom模板插入图片数列表
                        model.find('.list-item').html(imgStr);

                        imgListLeft(model.find('.img-list'),2);


                        //保存对象列表字符串到变量
                        str +=  model.html();

                        page = obj[i].page;
                    }

                    if(str == ''){

                        alert('没了')

                    }else{

                        //将变量字符串插入真实dom
                        $('#channel-latest').append(str);

                    }

                    return pageResult =  page;
                })
            }

            //图片组件==========================================================

            var w = $(window).width();

            var bannerListObj = $('.banner-list');

            $('.banner-img-main').css('width',bannerListObj.length*w + 'px')

            $('.banner-list').css('width',w + 'px');




            //==================================================================


            //图片大小和边距
            function imgListWidth(param){

                var w = JSON.parse(localStorage.getItem('device')).w

                var liw = (w-param*2)/3 - 0.1;

                $('.img-list').css({

                    width:liw + 'px',

                    height:liw + 'px',

                });
            }

            //边距(分别获取设置边距)
            function imgListLeft(obj,param){

                for(var i=0;i<obj.length;i++){

                    if(i%3!=0){ obj.eq(i).css('margin-left',param + 'px') }

                }
            }


            /*for(var i=0;i<obj.length;i++){

             var imgStr = '';

             if(obj[i].statusCode == 404){continue;}

             //列表id
             //model.find('.list-item').attr('data-id',obj[i].id);

             //时间
             model.find("[data-name='time']").text(obj[i].time);

             //========================================================
             for(var j=0;j<obj[i].imgPath.length;j++){

             imgListModel.find('.img-list').css('background-image',"url(img/"+obj[i].imgPath[j]+")").attr('data-id',j);

             imgStr += imgListModel.html();

             }
             //向内存中的dom模板插入图片数列表 && 顺带添加id
             model.find('.list-item').html(imgStr).attr('data-id',obj[i].id);

             imgListLeft(model.find('.img-list'),2);

             //=============================================================
             //保存对象列表字符串到变量
             str +=  model.html();
             }*/

        })
    </script>

</body>
</html>

















