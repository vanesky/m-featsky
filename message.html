<!doctype html>
<html lang="en">
<head>
    <title>FEATSKY Best-1.0</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="featsky,featsky博客,641151096"/>
    <meta name="description" content="featsky的个人博客,641151096的个人博客"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="src/css/base.css">
    <link rel="stylesheet" href="src/css/message.css">
</head>
<body>

    <header>
        <!--<img id="logo" src="img/logo.png" alt="">-->
        <ul class="menu-list fx-col-b">
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <h4 class="titles">留言</h4>
    </header>

    <div id="mes-input">
        <img class="img-edit va-c" src="img/fixed/edit.png" alt="">
        <span class="ml5 va-c">留言一番 . .</span>
    </div>

    <div class="container">
        <section id="mes-item">
            <div class="item-list hide">
                <div class="img-head bs-b dp-ib va-c"></div>
                <div class="dp-ib va-c ml3">
                    <h5>Featsky</h5>
                    <p class="fr10 c6 mt1">2016-02-15</p>
                </div>
                <p class="item-text">你这是多少fffffff放松放松的方式的范德萨发生的发送到发送到</p>
            </div>

        </section>
        <div class="load-button">查看更多</div>
    </div>

    <!--导航组件-->
    <div id="nav">
        <div class="nav-head"></div>
        <ul class="nav-item">
            <li data-name="index" class="nav-list">
                <img src="img/fixed/home-white.png" alt="">
                <span>主页</span>
            </li>
            <li data-name="say" class="nav-list">
                <img src="img/fixed/say-white.png" alt="">
                <span>说说</span>
            </li>
            <li data-name="article" class="nav-list">
                <img src="img/fixed/article-white.png" alt="">
                <span>文章</span>
            </li>
            <li data-name="movie" class="nav-list">
                <img src="img/fixed/movie-white.png" alt="">
                <span>影视</span>
            </li>
            <li data-name="photo" class="nav-list">
                <img src="img/fixed/photo-white.png" alt="">
                <span>照片</span>
            </li>
            <li data-name="message" class="nav-list">
                <img src="img/fixed/message.png" alt="">
                <span>留言</span>
            </li>
        </ul>
    </div>

    <!--=================列表模板===================-->
    <div id="model-1" class="hide">
        <div data-name="id" class="item-list">
            <div data-name="headPath" class="img-head bg-fill dp-ib va-c"></div>
            <!--<img class="img-head va-c" src="img/1.jpg" alt="">-->
            <div class="dp-ib va-c ml3">
                <h5 data-name="name"></h5>
                <p data-name="time" class="fr10 c6 mt1"></p>
            </div>
            <p data-name="text" class="item-text"></p>
        </div>
    </div>
    <!--==============================================-->

    <!--留言填写-->
    <section id="writing">

        <header style="position:relative;">
            <img class="back" src="img/fixed/arrow.png" alt="">
            <h4 class="titles">留言填写</h4>
        </header>

        <div class="writ-context">
            <input type="text" name="writTit" placeholder="您的称呼" class="ls1">
            <div class="fx-col-c pr-text">
                <div class="writ-prompt">说点什么吧..</div>
                <div name="writText" class="writ-text" contenteditable="true"></div>
            </div>
        </div>

        <div class="sub-cancel fx-row-b">
            <img id="upImg" src="img/fixed/up.png" alt="" class="img-edit ml10">
            <input name="upFile" type="file" accept="image/*">

        </div>

        <div class="sel-img fx-row-b">
            <div class="list-img">
                <img src="img/1.jpg" alt="">
                <div class="select-img">
                    <div class="select-yes"></div>
                </div>
            </div>
            <div class="list-img">
                <img src="img/1.jpg" alt="">
                <div class="select-img">
                    <div class="select-yes"></div>
                </div>
            </div>
            <div class="list-img">
                <img src="img/1.jpg" alt="">
                <div class="select-img">
                    <div class="select-yes"></div>
                </div>
            </div>
            <div class="list-img">
                <img src="img/1.jpg" alt="">
                <div class="select-img">
                    <div class="select-yes"></div>
                </div>
            </div>
            <div class="list-img">
                <img src="img/1.jpg" alt="">
                <div class="select-img">
                    <div class="select-yes"></div>
                </div>
            </div>
        </div>
        <input name="imgSrc" type="hidden" val="img/1.jpg">
        <div id="sub" class="w85 tc pdt10 pdb10 c-ba cf br5 mt40">发表</div>
        <div id="cancel" class="w85 tc pdt10 pdb10 bc-db cf br5 mt7">取消</div>
    </section>

    <section id="clip-img">
        <header style="position:relative;">
            <img class="back" src="img/fixed/arrow.png" alt="">
            <h4 class="titles">图片裁剪</h4>
        </header>
        <img src="img/21.jpg" alt="">
        <div class="clip-main"></div>
    </section>

    <script src="src/lib/zepto.js"></script>
    <script src="src/js/common.js"></script>
    <script src="src/js/ajax.js"></script>
    <script src="src/js/validate.js"></script>

    <script>
        $(function(){

            var pageResult = 0,pageCount = 4;

            renderInfo();

            //加载更多
            $('.load-button').on('tap',function(){

                renderInfo();

            })
            /*==================================================*/
            var writingObj = $('#writing');

            bom.moveDetail(writingObj);

            writingObj.on('touchmove',function(e){

                e.preventDefault();

            })

            var writObj = writingObj.find('.writ-text');

                writObj.on('focus',function(){

                    $('.writ-prompt').hide();

                })

            //点击留言事件
            $('#mes-input').on('tap',function(){
                //留言初始化
                $("[name='writTit']").val('');

                $("[name='imgSrc']").val('img/1.jpg');

                writObj.text('');

                $('.writ-prompt').show();

                $('.select-img').hide();

                $('.select-img').eq(1).show();


                writingObj.css('-webkit-transform','translateX(-100%)')

            })

            //**********************************************************

            var clipImgObj =  $('#clip-img');

            //上传图片按钮
            $('#upImg').on('tap',function(){

                $("input[name='upFile']").trigger('click')

            })
            //图片剪裁弹出

            bom.moveDetail(clipImgObj,function(){

                clipImgObj.css('display','none');

            });

            clipImgObj.on('touchmove',function(e){

                e.preventDefault();

            })

            //选择头像
            $('.list-img').on('tap',function(){

                var _this = $(this);

                $('.select-img').hide();

                _this.find('.select-img').show();

                $("input[name='imgSrc']").val(_this.find('img').prop('src'));

            })

            //提交
            $('#sub').on('tap',function(){

                if(!validateMethod(validate)){return}

            })
            //取消
            $('#cancel').on('tap',function(){

                writingObj.css('-webkit-transform','translateX(0%)')

            })

            //==============================================================
            var validate = {

                rules:{

                    writTit:{require:true,nameRule:true},

                    writText:{require:true,textRule:true}

                },

                prompt:{

                    writTit:{require:'请填写您的称呼',nameRule:'称呼需是4-6位的字母、数字、文字'},

                    writText:{require:'没有什么要说的吗',textRule:'您只能说汉字哦'}

                }
            }

            function validateMethod(validate){

                var str = '';

                $.each(validate.rules,function(attrName,attrObj){

                    var value = $("[name='"+attrName+"']").val();

                    if(!value){  value = $("[name='"+attrName+"']").text() }

                    $.each(attrObj,function(ruleName,ruleParam){

                        if(!window.validateRule[ruleName](value)){

                            str = validate.prompt[attrName][ruleName];

                            return false;

                        }

                    })

                    if(str){

                        alert(str);

                        return false;

                    }else{ return true }
                })
            }


            function renderInfo(){

                app.ajax('get',app.url('getMesList.php'),{page:pageCount,pageStart:pageResult},function(data){

                    var obj = data,str = '';

                    console.log(obj);

                    var model = $('#model-1').clone();

                    for(var i=0;i<obj.length;i++){

                        if(obj[i].statusCode == 404){continue;}

                        //列表id
                        model.find("[data-name='id']").attr('data-id',obj[i].id);

                        //列表背景
                        model.find("[data-name='headPath']").css('background-image',"url(img/"+obj[i].headPath+")");

                        //标题
                        model.find("[data-name='name']").text(obj[i].name);

                        //时间
                        model.find("[data-name='time']").text(obj[i].time);

                        //内容
                        model.find("[data-name='text']").text(obj[i].text);

                        str +=  model.html();
                    }

                    if(str == ''){

                        alert('没了')

                    }else{

                        $('#mes-item').append(str);

                    }


                    return pageResult = pageResult + pageCount;

                })
            }


        })
    </script>

</body>
</html>